<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>Document</title>
		<link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="../../css/layer-set-myself.css" media="all" />
		<link rel="stylesheet" href="../../css/flex.css" media="all" />

		<style>

		</style>
	</head>

	<body class="childrenBody">
		<blockquote class="layui-elem-quote">为节省服务器开销，以下示例均未配置真实上传接口，所以每次上传都会报提示：请求上传接口出现异常，这属于正常现象。</blockquote>

		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
			<legend>指定允许上传的文件类型</legend>
		</fieldset>

		<!--<button type="button" class="layui-btn site-demo-active" id="test5" data-type="loading"><i class="layui-icon"></i>上传视频</button>-->
		<div class="layui-upload">
			<button type="button" class="layui-btn layui-btn-normal" id="test8">选择文件</button>
			<button type="button" class="layui-btn site-demo-active" id="test9" data-type="loading">开始上传</button>
		</div>

		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
			<legend>动态改变进度</legend>
		</fieldset>

		<div class="layui-progress layui-progress-big" lay-showpercent="true" lay-filter="demo" style="width: 50%;">
			<div class="layui-progress-bar layui-bg-red" lay-percent="0%"></div>
		</div>

		<!--<div class="site-demo-button" style="margin-top: 20px; margin-bottom: 0;">
			<button class="layui-btn site-demo-active" data-type="setPercent">设置50%</button>
			<button class="layui-btn site-demo-active" data-type="loading">模拟loading</button>
		</div>-->

		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../layui/layui.js"></script>
		<!--<script type="text/javascript" src="../../js/common.js"></script>-->
		<!--<script type="text/javascript" src="../../js/table.js"></script>-->
		<!--<script type="text/javascript" src="../../js/layFun.js"></script>-->
		<script>
			layui.use(['upload', 'element'], function() {
				var $ = layui.jquery,
					upload = layui.upload,
					element = layui.element;
				var n=0;
				var othis = $('.site-demo-active');
				var DISABLED = 'layui-btn-disabled';
				//选完文件后不自动上传
				upload.render({
					elem: '#test8',
					url: '/temp/',
					accept: 'video',
					auto: false
						//,multiple: true
						,
					bindAction: '#test9',
					done: function(res) {
//						process();
						var datas = {};
						datas.img_list = res.newpath;
						datas = JSON.stringify(datas);
						console.log(datas)
						$.ajax({
							url: "/ajax.post?func=massMP4",
							type: "POST",
							data: "data=" + datas,
							beforeSend: function () {
								timer = setInterval(function() {
									n = n + Math.random() * 10 | 0;
									if(n > 70) {
										n = 70;
										clearInterval(timer);
									}
									element.progress('demo', n + '%');
								}, 500);
						       
						    },
							success: function(json) {
								element.progress('demo', '90%');
							},
							complete: function () {
								element.progress('demo', '100%');
						    }
							
						});
					}
				});

				//				
				var active = {
					
					loading: function(othis) {
						var DISABLED = 'layui-btn-disabled';
						if(othis.hasClass(DISABLED)) return;

						//模拟loading
						var n = 0,
							timer = setInterval(function() {
								n = n + Math.random() * 10 | 0;
								if(n > 100) {
									n = 100;
									clearInterval(timer);
									othis.removeClass(DISABLED);
								}
								element.progress('demo', n + '%');
							}, 300 + Math.random() * 1000);

						othis.addClass(DISABLED);
					}
				};

//				$('.site-demo-active').on('click', function() {
				function process(){
					var othis = $('.site-demo-active'),
						type = $('.site-demo-active').data('type');
					active[type] ? active[type].call(this, othis) : '';
				}

					
//				});

			});
		</script>

	</body>

</html>